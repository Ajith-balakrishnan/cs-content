#   (c) Copyright 2014 Hewlett-Packard Development Company, L.P.
#   All rights reserved. This program and the accompanying materials
#   are made available under the terms of the Apache License v2.0 which accompany this distribution.
#
#   The Apache License is available at
#   http://www.apache.org/licenses/LICENSE-2.0
#
####################################################

machine:
  services:
    - docker

dependencies:
#  cache_directories:
#    - "~/docker"
  override:
    - docker info
    - docker images
#    - if [[ -e ~/docker/image.tar ]]; then docker load -i ~/docker/image.tar; fi
#    - docker pull orius123/dind-ssh
#    - mkdir -p ~/docker; docker save orius123/dind-ssh > ~/docker/image.tar

test:
  pre:
    - docker run --privileged -d --name cadvisor --volume=/var/run:/var/run:rw --volume=/sys:/sys:ro --volume=/var/lib/docker/:/var/lib/docker:ro --volume=/cgroup:/cgroup --publish=32951:8080 google/cadvisor:latest
#    - docker run --privileged --lxc-conf="lxc.aa_profile=unconfined" -d -p 4444 -p 49153:22 -e PORT=4444 --name docker_host_ssh orius123/dind-ssh
#    - docker port docker_host_ssh 22
  override:
    - wget https://github.com/CloudSlang/cloud-slang/releases/download/cloudslang-0.7.28/cslang-builder.zip
    - unzip cslang-builder.zip -d cslang-builder
    - chmod +x cslang-builder/bin/cslang-builder
    - ./cslang-builder/bin/cslang-builder -ts cadvisor
  post:
    - docker ps -a
#    - docker stop $(docker ps -a -q)
#    - docker rm $(docker ps -a -q)